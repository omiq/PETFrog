program PETFrog;

var
@use "input/key"  
@use "crt"

key_up,key_down,key_left,key_right,kk:integer;


/* === variables ============================================================================================ */


@include "variables.ras"
		
/* === functions ============================================================================================ */

@include "functions.ras"

/* === main logic ============================================================================================ */


procedure game_loop();

begin
	
	Key::SetupScreenCodes();

	// Unit constants
		key_up:=Key::KQ;
        key_down:=Key::KA;
        key_left:=Key::KO;
        key_right:=Key::KP;


	while (ALIVE=1 and WON_GAME=0) do
	begin

		Key::Read();

        frog_old_x:=frog_x;
        frog_old_y:=frog_y;
        if(Key::Pressed(key_up)) then
        begin
            if(frog_y>1) then
            begin
                dec(frog_y);
            end;
        end;
        
        if(Key::Pressed(key_right)) then
        begin
            if(frog_x<39) then
            begin
                inc(frog_x);
            end;
        end;
        
        if(Key::Pressed(key_down)) then
        begin
            if(frog_y<24) then
            begin
                inc(frog_y);
            end;
        end;
        if(Key::Pressed(key_left)) then
        begin
            if(frog_x>0) then
            begin
                dec(frog_x);
            end;
        end;
		
		// So different things can move at own speeds
		incrange(GAME_TICKS,1,10);
		
		// Show the obstacles in new positions
		show_obstacles();
		
		// "Collision detection"
		check_collisions();

		// Still alive?
		if(player_lives<1) then
		begin
			// Dead and didn't win :(
			ALIVE:=0;
				
		end;	



		// only undraw if different
		if(frog_x<>frog_old_x or frog_y<>frog_old_y ) then
		begin
			textat(frog_old_x,frog_old_y, #previous_tile,1);
			previous_tile:=getat(frog_x,frog_y);	
		end;	
		
		// draw the frog because things might have changed onscreen
		if(frog_y>10) then
		begin
			textat(frog_x,frog_y, #frogcharA,1);	
		end
		else
		begin
			textat(frog_x,frog_y, #frogcharB,1);	
		end;


		
		// Score and lives
		moveto(9,0,hi(#$8000));
		printdecimal(player_score,3);		
		moveto(36,0,hi(#$8000));
		printdecimal(player_lives,1);		


	end;

end;

begin
	DefineScreen();	

	while(1) do
	begin
		title_screen();
		init_vars();
		game_loop();
		score_screen();
	end;

	

end.

